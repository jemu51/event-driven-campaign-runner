{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Event Contracts",
  "description": "All event schemas for the recruitment automation system",
  "version": "1.0.0",

  "definitions": {
    "trace_context": {
      "type": "object",
      "description": "OpenTelemetry trace context for distributed tracing",
      "properties": {
        "trace_id": {
          "type": "string",
          "pattern": "^[a-f0-9]{32}$",
          "description": "32-character hex trace ID"
        },
        "span_id": {
          "type": "string",
          "pattern": "^[a-f0-9]{16}$",
          "description": "16-character hex span ID"
        },
        "parent_span_id": {
          "type": "string",
          "pattern": "^[a-f0-9]{16}$",
          "description": "16-character hex parent span ID"
        }
      },
      "required": ["trace_id"]
    },
    "attachment": {
      "type": "object",
      "description": "Email attachment metadata",
      "required": ["filename", "s3_path", "content_type", "size_bytes"],
      "properties": {
        "filename": {
          "type": "string",
          "description": "Original filename of the attachment"
        },
        "s3_path": {
          "type": "string",
          "pattern": "^s3://",
          "description": "S3 URI where attachment is stored"
        },
        "content_type": {
          "type": "string",
          "description": "MIME type of the attachment"
        },
        "size_bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "File size in bytes"
        }
      }
    }
  },

  "events": {
    "NewCampaignRequested": {
      "version": "1.0.0",
      "source": "recruitment.api",
      "description": "Buyer creates new recruitment campaign",
      "triggers": ["CampaignPlannerAgent"],
      "produces": ["SendMessageRequested"],
      "detail_schema": {
        "type": "object",
        "required": ["campaign_id", "buyer_id", "requirements"],
        "properties": {
          "campaign_id": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9-]+$",
            "description": "Unique campaign identifier"
          },
          "buyer_id": {
            "type": "string",
            "description": "Buyer/client identifier"
          },
          "requirements": {
            "type": "object",
            "required": ["type"],
            "properties": {
              "type": {
                "type": "string",
                "description": "Campaign type (e.g., satellite_upgrade, fiber_install)"
              },
              "markets": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Target geographic markets"
              },
              "providers_per_market": {
                "type": "integer",
                "minimum": 1,
                "description": "Number of qualified providers needed per market"
              },
              "equipment": {
                "type": "object",
                "properties": {
                  "required": {
                    "type": "array",
                    "items": {"type": "string"},
                    "description": "Required equipment keywords"
                  },
                  "optional": {
                    "type": "array",
                    "items": {"type": "string"},
                    "description": "Nice-to-have equipment keywords"
                  }
                }
              },
              "documents": {
                "type": "object",
                "properties": {
                  "required": {
                    "type": "array",
                    "items": {"type": "string"},
                    "description": "Required document types"
                  },
                  "insurance_min_coverage": {
                    "type": "integer",
                    "description": "Minimum insurance coverage in dollars"
                  }
                }
              },
              "certifications": {
                "type": "object",
                "properties": {
                  "required": {
                    "type": "array",
                    "items": {"type": "string"}
                  },
                  "preferred": {
                    "type": "array",
                    "items": {"type": "string"}
                  }
                }
              },
              "travel_required": {
                "type": "boolean",
                "description": "Whether provider must be willing to travel"
              }
            }
          },
          "trace_context": {"$ref": "#/definitions/trace_context"}
        }
      }
    },

    "SendMessageRequested": {
      "version": "1.0.0",
      "source": "recruitment.agents.campaign_planner",
      "description": "Request to send email to provider",
      "triggers": ["CommunicationAgent"],
      "produces": [],
      "detail_schema": {
        "type": "object",
        "required": ["campaign_id", "provider_id", "message_type"],
        "properties": {
          "campaign_id": {
            "type": "string",
            "description": "Campaign identifier"
          },
          "provider_id": {
            "type": "string",
            "description": "Provider identifier"
          },
          "provider_email": {
            "type": "string",
            "format": "email",
            "description": "Provider's email address"
          },
          "provider_name": {
            "type": "string",
            "description": "Provider's display name"
          },
          "provider_market": {
            "type": "string",
            "description": "Market the provider is being recruited for"
          },
          "message_type": {
            "type": "string",
            "enum": ["initial_outreach", "follow_up", "missing_document", "clarification", "qualified_confirmation", "rejection"],
            "description": "Type of message being sent"
          },
          "template_data": {
            "type": "object",
            "description": "Data for email template rendering",
            "properties": {
              "campaign_type": {"type": "string"},
              "market": {"type": "string"},
              "equipment_list": {"type": "string"},
              "insurance_requirement": {"type": "string"},
              "missing_documents": {"type": "array", "items": {"type": "string"}},
              "question": {"type": "string"},
              "reason": {"type": "string"},
              "next_steps": {"type": "string"},
              "days_since_contact": {"type": "integer"}
            }
          },
          "custom_message": {
            "type": "string",
            "description": "Optional custom message content (overrides template)"
          },
          "trace_context": {"$ref": "#/definitions/trace_context"}
        }
      }
    },

    "ProviderResponseReceived": {
      "version": "1.0.0",
      "source": "recruitment.lambdas.process_inbound_email",
      "description": "Provider replied to outreach email",
      "triggers": ["ScreeningAgent"],
      "produces": ["SendMessageRequested", "DocumentProcessed", "ScreeningCompleted"],
      "detail_schema": {
        "type": "object",
        "required": ["campaign_id", "provider_id", "body", "received_at", "email_thread_id"],
        "properties": {
          "campaign_id": {
            "type": "string",
            "description": "Campaign identifier"
          },
          "provider_id": {
            "type": "string",
            "description": "Provider identifier"
          },
          "body": {
            "type": "string",
            "minLength": 1,
            "maxLength": 10000,
            "description": "Email body text (plaintext preferred)"
          },
          "attachments": {
            "type": "array",
            "items": {"$ref": "#/definitions/attachment"},
            "description": "List of email attachments with S3 paths"
          },
          "received_at": {
            "type": "integer",
            "minimum": 0,
            "description": "Unix epoch timestamp when email was received"
          },
          "email_thread_id": {
            "type": "string",
            "description": "SES message/thread identifier"
          },
          "from_address": {
            "type": "string",
            "format": "email",
            "description": "Sender's email address"
          },
          "subject": {
            "type": "string",
            "description": "Email subject line"
          },
          "trace_context": {"$ref": "#/definitions/trace_context"}
        }
      }
    },

    "DocumentProcessed": {
      "version": "1.0.0",
      "source": "recruitment.lambdas.textract_completion",
      "description": "Document OCR completed via Textract",
      "triggers": ["ScreeningAgent"],
      "produces": ["ScreeningCompleted", "SendMessageRequested"],
      "detail_schema": {
        "type": "object",
        "required": ["campaign_id", "provider_id", "document_s3_path", "document_type", "job_id"],
        "properties": {
          "campaign_id": {
            "type": "string",
            "description": "Campaign identifier"
          },
          "provider_id": {
            "type": "string",
            "description": "Provider identifier"
          },
          "document_s3_path": {
            "type": "string",
            "pattern": "^s3://",
            "description": "S3 URI of the processed document"
          },
          "document_type": {
            "type": "string",
            "enum": ["insurance_certificate", "license", "certification", "w9", "other"],
            "description": "Classified document type"
          },
          "job_id": {
            "type": "string",
            "description": "Textract job identifier"
          },
          "ocr_text": {
            "type": "string",
            "description": "Raw OCR text extracted from document"
          },
          "extracted_fields": {
            "type": "object",
            "description": "Structured data extracted from document",
            "properties": {
              "expiry_date": {
                "type": "string",
                "format": "date",
                "description": "Document expiry date (ISO 8601)"
              },
              "coverage_amount": {
                "type": "integer",
                "minimum": 0,
                "description": "Insurance coverage in dollars"
              },
              "policy_holder": {
                "type": "string",
                "description": "Name on policy/document"
              },
              "policy_number": {
                "type": "string",
                "description": "Policy or document number"
              },
              "insurance_company": {
                "type": "string",
                "description": "Insurance carrier name"
              }
            }
          },
          "confidence_scores": {
            "type": "object",
            "description": "OCR confidence scores per field",
            "additionalProperties": {"type": "number", "minimum": 0, "maximum": 1}
          },
          "trace_context": {"$ref": "#/definitions/trace_context"}
        }
      }
    },

    "ScreeningCompleted": {
      "version": "1.0.0",
      "source": "recruitment.agents.screening",
      "description": "Provider screening finished with decision",
      "triggers": ["NotificationAgent"],
      "produces": [],
      "detail_schema": {
        "type": "object",
        "required": ["campaign_id", "provider_id", "decision"],
        "properties": {
          "campaign_id": {
            "type": "string",
            "description": "Campaign identifier"
          },
          "provider_id": {
            "type": "string",
            "description": "Provider identifier"
          },
          "decision": {
            "type": "string",
            "enum": ["QUALIFIED", "REJECTED", "ESCALATED", "UNDER_REVIEW"],
            "description": "Final screening decision"
          },
          "reasoning": {
            "type": "string",
            "description": "Human-readable explanation of decision"
          },
          "confidence_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Confidence in the decision (0-1)"
          },
          "screening_results": {
            "type": "object",
            "description": "Detailed screening analysis",
            "properties": {
              "equipment_confirmed": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Equipment provider confirmed having"
              },
              "equipment_missing": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Required equipment not confirmed"
              },
              "travel_confirmed": {
                "type": "boolean",
                "description": "Whether travel willingness was confirmed"
              },
              "documents_valid": {
                "type": "boolean",
                "description": "Whether required documents are valid"
              },
              "insurance_coverage": {
                "type": "integer",
                "description": "Verified insurance coverage amount"
              },
              "insurance_expiry": {
                "type": "string",
                "format": "date",
                "description": "Insurance expiry date"
              },
              "certifications_found": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Certifications identified"
              }
            }
          },
          "artifacts_reviewed": {
            "type": "array",
            "items": {"type": "string"},
            "description": "S3 paths of documents reviewed"
          },
          "trace_context": {"$ref": "#/definitions/trace_context"}
        }
      }
    },

    "FollowUpTriggered": {
      "version": "1.0.0",
      "source": "recruitment.lambdas.send_follow_ups",
      "description": "Scheduled follow-up reminder triggered for dormant session",
      "triggers": ["CommunicationAgent"],
      "produces": ["SendMessageRequested"],
      "detail_schema": {
        "type": "object",
        "required": ["campaign_id", "provider_id", "follow_up_number", "days_since_last_contact"],
        "properties": {
          "campaign_id": {
            "type": "string",
            "description": "Campaign identifier"
          },
          "provider_id": {
            "type": "string",
            "description": "Provider identifier"
          },
          "reason": {
            "type": "string",
            "enum": ["no_response", "missing_document", "incomplete_info"],
            "description": "Reason for follow-up"
          },
          "follow_up_number": {
            "type": "integer",
            "minimum": 1,
            "maximum": 3,
            "description": "Which follow-up attempt this is (1-3)"
          },
          "days_since_last_contact": {
            "type": "integer",
            "minimum": 0,
            "description": "Days elapsed since last provider contact"
          },
          "current_status": {
            "type": "string",
            "description": "Provider's current status"
          },
          "trace_context": {"$ref": "#/definitions/trace_context"}
        }
      }
    },

    "ReplyToProviderRequested": {
      "version": "1.0.0",
      "source": "recruitment.agents.screening",
      "description": "Request to send a reply to provider for missing/invalid content",
      "triggers": ["CommunicationAgent"],
      "produces": [],
      "detail_schema": {
        "type": "object",
        "required": ["campaign_id", "provider_id", "reply_type", "context"],
        "properties": {
          "campaign_id": {
            "type": "string",
            "description": "Campaign identifier"
          },
          "provider_id": {
            "type": "string",
            "description": "Provider identifier"
          },
          "provider_email": {
            "type": "string",
            "format": "email",
            "description": "Provider's email address"
          },
          "provider_name": {
            "type": "string",
            "description": "Provider's display name"
          },
          "provider_market": {
            "type": "string",
            "description": "Market the provider is being recruited for"
          },
          "reply_type": {
            "type": "string",
            "enum": ["missing_document", "invalid_document", "clarification_needed", "additional_info"],
            "description": "Type of reply being requested"
          },
          "context": {
            "type": "object",
            "description": "Context for generating the reply",
            "properties": {
              "missing_items": {
                "type": "array",
                "items": {"type": "string"},
                "description": "List of missing documents or information"
              },
              "validation_errors": {
                "type": "array",
                "items": {"type": "string"},
                "description": "List of validation errors found"
              },
              "questions": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Questions to ask the provider"
              },
              "original_response_summary": {
                "type": "string",
                "description": "Summary of the provider's original response"
              }
            }
          },
          "in_reply_to_message_id": {
            "type": "string",
            "description": "Message ID of the email being replied to"
          },
          "trace_context": {"$ref": "#/definitions/trace_context"}
        }
      }
    }
  },

  "notes": [
    "All events support optional trace_context for OpenTelemetry propagation",
    "Timestamps are Unix epoch integers (seconds since 1970-01-01 UTC)",
    "S3 paths use s3:// URI format",
    "Dates use ISO 8601 format (YYYY-MM-DD)",
    "See PHASE 10 in ARCHITECHTURE.md for demo scenario event examples"
  ]
}
